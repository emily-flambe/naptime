name: Emoji Linter

on:
  pull_request:
    branches: [main]
  push:
    branches-ignore: [main]

jobs:
  emoji-lint:
    name: Check for emojis in codebase
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      - name: Check for emojis in source files
        run: |
          echo "ðŸ” Scanning for emojis in source code files..."
          
          # Define file patterns to check (exclude documentation and build artifacts)
          PATTERNS=(
            "*.js" "*.jsx" "*.ts" "*.tsx" 
            "*.py" "*.java" "*.go" "*.rs" 
            "*.c" "*.cpp" "*.h" "*.hpp"
            "*.php" "*.rb" "*.swift" "*.kt"
          )
          
          # Build find command with all patterns
          FIND_CMD="find . -type f \("
          for i in "${!PATTERNS[@]}"; do
            if [ $i -eq 0 ]; then
              FIND_CMD="$FIND_CMD -name \"${PATTERNS[$i]}\""
            else
              FIND_CMD="$FIND_CMD -o -name \"${PATTERNS[$i]}\""
            fi
          done
          FIND_CMD="$FIND_CMD \) -not -path \"*/node_modules/*\" -not -path \"*/dist/*\" -not -path \"*/build/*\" -not -path \"*/.git/*\""
          
          # Count total files to scan
          TOTAL_FILES=$(eval $FIND_CMD | wc -l)
          echo "ðŸ“Š Scanning $TOTAL_FILES source files for emoji violations..."
          
          # Search for emoji patterns (Unicode ranges for common emojis)
          EMOJI_FILES=$(eval $FIND_CMD -exec grep -l $'[\U0001F600-\U0001F64F\U0001F300-\U0001F5FF\U0001F680-\U0001F6FF\U0001F700-\U0001F77F\U0001F780-\U0001F7FF\U0001F800-\U0001F8FF\U0001F900-\U0001F9FF\U0001FA00-\U0001FA6F\U0001FA70-\U0001FAFF\U0002600-\U000026FF\U0002700-\U000027BF\U00002B50\U00002B55\U0000231A-\U0000231B\U000023E9-\U000023EC\U000023F0\U000023F3\U0000260E-\U0000260F\U00002614-\U00002615\U00002618\U0000261D\U00002620\U00002622-\U00002623\U00002626\U0000262A\U0000262E-\U0000262F\U00002638-\U00002639\U0000263A\U00002648-\U00002653\U0000265F-\U00002660\U00002663\U00002665-\U00002666\U00002668\U0000267B\U0000267E-\U0000267F\U00002692-\U00002697\U00002699\U000026A0-\U000026A1\U000026A7\U000026AA-\U000026AB\U000026B0-\U000026B1\U000026BD-\U000026BE\U000026C4-\U000026C5\U000026C8\U000026CE\U000026CF\U000026D1\U000026D3-\U000026D4\U000026E9-\U000026EA\U000026F0-\U000026F5\U000026F7-\U000026FA\U000026FD\U00002702\U00002708-\U00002709\U0000270C-\U0000270D\U0000270F\U00002712\U00002714\U00002716\U0000271D\U00002721\U00002733-\U00002734\U00002744\U00002747\U0000274C\U0000274E\U00002753-\U00002755\U00002757\U00002763-\U00002764\U00002795-\U00002797\U000027A1\U000027B0\U000027BF\U00002934-\U00002935\U00002B05-\U00002B07\U00002B1B-\U00002B1C\U00002B50\U00002B55\U00003030\U0000303D\U00003297\U00003299]' {} \; 2>/dev/null || true)
          
          if [ -n "$EMOJI_FILES" ]; then
            echo "âŒ EMOJI POLICY VIOLATION: Found emojis in source files!"
            echo "ðŸ“ Files containing emojis:"
            echo "$EMOJI_FILES" | while read -r file; do
              echo "  - $file"
              # Show specific emoji matches
              grep --color=never -n $'[\U0001F600-\U0001F64F\U0001F300-\U0001F5FF\U0001F680-\U0001F6FF\U0001F700-\U0001F77F\U0001F780-\U0001F7FF\U0001F800-\U0001F8FF\U0001F900-\U0001F9FF\U0001FA00-\U0001FA6F\U0001FA70-\U0001FAFF\U0002600-\U000026FF\U0002700-\U000027BF\U00002B50\U00002B55\U0000231A-\U0000231B\U000023E9-\U000023EC\U000023F0\U000023F3\U0000260E-\U0000260F\U00002614-\U00002615\U00002618\U0000261D\U00002620\U00002622-\U00002623\U00002626\U0000262A\U0000262E-\U0000262F\U00002638-\U00002639\U0000263A\U00002648-\U00002653\U0000265F-\U00002660\U00002663\U00002665-\U00002666\U00002668\U0000267B\U0000267E-\U0000267F\U00002692-\U00002697\U00002699\U000026A0-\U000026A1\U000026A7\U000026AA-\U000026AB\U000026B0-\U000026B1\U000026BD-\U000026BE\U000026C4-\U000026C5\U000026C8\U000026CE\U000026CF\U000026D1\U000026D3-\U000026D4\U000026E9-\U000026EA\U000026F0-\U000026F5\U000026F7-\U000026FA\U000026FD\U00002702\U00002708-\U00002709\U0000270C-\U0000270D\U0000270F\U00002712\U00002714\U00002716\U0000271D\U00002721\U00002733-\U00002734\U00002744\U00002747\U0000274C\U0000274E\U00002753-\U00002755\U00002757\U00002763-\U00002764\U00002795-\U00002797\U000027A1\U000027B0\U000027BF\U00002934-\U00002935\U00002B05-\U00002B07\U00002B1B-\U00002B1C\U00002B50\U00002B55\U00003030\U0000303D\U00003297\U00003299]' "$file" | head -3
            done
            echo ""
            echo "ðŸš« This violates the project's strict no-emoji policy!"
            echo "Please remove all emojis from source code, comments, and strings."
            exit 1
          else
            FILES_WITH_EMOJIS=0
            echo "âœ… SUCCESS: No emojis found in $TOTAL_FILES source files!"
            echo "ðŸŽ‰ Codebase complies with no-emoji policy."
          fi
          
          # Set outputs for other steps
          echo "has-emojis=$([ -n \"$EMOJI_FILES\" ] && echo true || echo false)" >> $GITHUB_OUTPUT
          echo "emoji-count=0" >> $GITHUB_OUTPUT
          echo "files-with-emojis=${FILES_WITH_EMOJIS:-0}" >> $GITHUB_OUTPUT
          echo "total-files=$TOTAL_FILES" >> $GITHUB_OUTPUT
        id: emoji-check
        
      - name: Report Results
        if: always()
        run: |
          echo "Has emojis: ${{ steps.emoji-check.outputs.has-emojis }}"
          echo "Emoji count: ${{ steps.emoji-check.outputs.emoji-count }}"
          echo "Files with emojis: ${{ steps.emoji-check.outputs.files-with-emojis }}"
          echo "Total files scanned: ${{ steps.emoji-check.outputs.total-files }}"
          
      - name: Fail if emojis found
        if: steps.emoji-check.outputs.has-emojis == 'true'
        run: |
          echo "ERROR: Emojis found in codebase! This violates the project's no-emoji policy."
          echo "Please remove all emojis from source code, comments, and documentation."
          exit 1